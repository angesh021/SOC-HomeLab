<!-- Local custom rules -->

<group name="local,custom,">

  <!-- ===========================================================
       CUSTOM RULE: Linux SSH Failed Login (From Specific Attacker)
       =========================================================== -->
  <rule id="100001" level="5">
    <!-- 5710 = sshd: failed login (check your base rules if different) -->
    <if_sid>5710</if_sid>
    <srcip>1.1.1.1</srcip>
    <description>SSH authentication failed from attacker IP 1.1.1.1</description>
    <group>authentication_failed,brute_force,custom,</group>
  </rule>

  <!-- =================================================================
       CUSTOM RULE: SSH brute-force (10 failures in 1 minute from 1 host)
       ================================================================= -->
  <rule id="100002" level="10">
    <if_matched_sid>5710</if_matched_sid>
    <same_source_ip />
    <description>SSH Brute-force: More than 10 failed login attempts in 1 minute</description>
    <group>brute_force,attack_attempt,custom,</group>
  </rule>

  <!-- ==================================================================
       CUSTOM RULE: Detect nmap scanning (SYN scan)
       (depends on what logs you send – adjust if_sid as needed)
       ================================================================== -->
  <rule id="100003" level="12">
    <!-- Example: if you later ingest network logs that trigger some sid -->
    <!-- Change 81601 to the real sid once you know it -->
    <if_sid>81601</if_sid>
    <description>Potential Port Scan Detected (SYN Scan / Nmap)</description>
    <group>network,scan,threat,custom,</group>
  </rule>

  <!-- ==================================================================
       CUSTOM RULE: Windows Sysmon - Suspicious PowerShell
       ================================================================== -->
  <rule id="100004" level="10">
    <!-- 61601 = Sysmon process creation in the default Wazuh decoders -->
    <if_sid>61601</if_sid>
    <match>powershell.exe</match>
    <regex>-enc|-EncodedCommand|Invoke-WebRequest|IEX</regex>
    <description>Suspicious PowerShell execution detected (Sysmon)</description>
    <group>windows,sysmon,powershell,attack_execution,custom,</group>
  </rule>

  <!-- ==================================================================
       CUSTOM RULE: Windows - New EXE dropped in user profile
       ================================================================== -->
  <rule id="100005" level="12">
    <!-- 554 = Syscheck file added/modified event -->
    <if_sid>554</if_sid>
    <match>.exe</match>
    <match>Users</match>
    <description>Executable file created in user directory — Possible malware drop</description>
    <group>malware,file_creation,windows,custom,</group>
  </rule>

  <!-- ==================================================================
       CUSTOM RULE: Detect Defender Disabled
       (adjust if_sid if your environment uses a different rule for this)
       ================================================================== -->
  <rule id="100006" level="14">
    <!-- Example SID where Defender-disabled events are normalized -->
    <if_sid>18107</if_sid>
    <description>Windows Defender disabled — Critical security event</description>
    <group>windows,defense_evasion,attack_attempt,custom,</group>
  </rule>

  <!-- ==================================================================
       CUSTOM RULE: Detect Suspicious Network Traffic (Sysmon ID 3)
       ================================================================== -->
  <rule id="100007" level="6">
    <!-- 61603 = Sysmon network connection event -->
    <if_sid>61603</if_sid>
    <!-- Attacker Kali IP on ATTACK_NET -->
    <regex>10\.20\.20\.10</regex>
    <description>Connection attempt to sensitive host from attacker network</description>
    <group>network,threat,attacker_detection,custom,</group>
  </rule>

  <!-- ==================================================================
       CUSTOM RULE: CMD execution from user profiles
       ================================================================== -->
  <rule id="100008" level="7">
    <if_sid>61601</if_sid>
    <match>cmd.exe</match>
    <match>Users</match>
    <description>CMD launched in user directory — possible initial access</description>
    <group>windows,execution,sysmon,custom,</group>
  </rule>

</group>
